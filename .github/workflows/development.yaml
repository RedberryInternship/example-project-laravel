name: Development

on: 
  push:
    branches:
      - "development"
  pull_request:
    branches:
      - "development"

jobs:
  testing:
    runs-on: ubuntu-20.04
    
    steps:
      - uses: shivammathur/setup-php@v2
        with:
          php-version: '7.4'
      - uses: actions/checkout@v2
      - name: Copy .env
        run: php -r "file_exists('.env') || copy('.env.example', '.env');"
      - name: Install Dependencies
        run: composer install -q --no-ansi --no-interaction --no-scripts --no-progress --prefer-dist
      - name: Setup Project
        run: |
          php artisan key:generate
          php artisan jwt:secret
          php artisan config:clear
          php artisan cache:clear
      - name: Directory Permissions
        run: chmod 777 -R storage bootstrap/cache
      - name: Create SQLite database
        run: |
          mkdir -p database
          touch database/database.sqlite
      - name: Run Unit tests
        env:
          DB_CONNECTION: sqlite
          DB_DATABASE: database/database.sqlite
          APP_ENV: testing
        run: vendor/bin/phpunit
      - name: Deploy to Server
        uses: appleboy/ssh-action@master
        with:
          host: 18.184.20.42
          username: forge
          key: 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
          script: |
            whoami
            ls -al
